CREATE TABLE `user` (
  `uid` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '用户uid。自增，主键',
  `avatar` varchar(200) NOT NULL DEFAULT '' COMMENT '头像url地址',
  `gender` tinyint(1) DEFAULT '0' COMMENT '性别 0:未知 1:男 2:女',
  `nick_name` varchar(50) NOT NULL DEFAULT '' COMMENT '昵称',
  `true_name` varchar(20) NOT NULL DEFAULT '' COMMENT '真实名称',
  `phone` varchar(11) NOT NULL DEFAULT '0' COMMENT '手机号码',
  `lxn_uid` bigint(20) unsigned NOT NULL DEFAULT 0 COMMENT '关联蓝犀牛user表id',
  `open_id` varchar(200) NOT NULL DEFAULT '' COMMENT 'open_id',
  `longitude` varchar(25) DEFAULT NULL DEFAULT '' COMMENT '经度',
  `latitude` varchar(25) DEFAULT NULL DEFAULT '' COMMENT '维度',
  `status` tinyint(1) NOT NULL DEFAULT '1' COMMENT '会员状态 0:不正常, 1:正常',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `city` varchar(100) DEFAULT NULL COMMENT '城市',
  PRIMARY KEY (`uid`),
  KEY `idx_phone` (`phone`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';


#一期暂不考虑优惠券

CREATE TABLE `order` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT 'id 自增，主键',
  `lxn_order_number` bigint(20) unsigned NOT NULL DEFAULT 0 COMMENT '关联主站orderinfo表中的OrderNum',
  `tid` bigint(20) unsigned NOT NULL DEFAULT 0 COMMENT '淘宝方的交易编号',
  `title` varchar(128) NOT NULL DEFAULT '' COMMENT '交易标题',
  `uid` bigint(20) unsigned NOT NULL DEFAULT 0 COMMENT '关联user表中uid',
  `driver_uid` bigint(20) unsigned NOT NULL DEFAULT 0 COMMENT '接单司机uid',
  `price` decimal(15,2) NOT NULL DEFAULT '0.00' COMMENT '淘宝端实付金额',
  `final_price` decimal(15,2) NOT NULL DEFAULT '0.00' COMMENT '支付尾款',
  `payment` decimal(15,2) NOT NULL DEFAULT '0.00' COMMENT '订单最终价格, 包含向司机支付尾款',
  `sku_id` varchar(64) NOT NULL DEFAULT '' COMMENT '商品id',
  `snapshot_id` bigint(20) unsigned NOT NULL DEFAULT 0 COMMENT '快照id',
  `status` varchar(50) NOT NULL DEFAULT '' COMMENT '订单状态 淘宝端定义的订单状态 WAIT_BUYER_PAY等 同步时需要映射主站状态',
  `serve_type` varchar(10) DEFAULT '100' COMMENT '100 预约服务 200 马上服务',
  `remark` varchar(1000) NOT NULL COMMENT '备注',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '订单生成时间',
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_lxn_order_number` (`lxn_order_number`),
  KEY `idx_uid_status` (`uid`, `status`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT='订单表';



//司机以扩展信息以快照的形式存储
CREATE TABLE `order_snapshot` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT 'id 自增，主键',
  `order_id` bigint(20) unsigned NOT NULL DEFAULT '订单id 对应order表中的id',
  `driver_name` varchar(16) NOT NULL DEFAULT '' COMMENT '司机姓名',
  `driver_phone` varchar(11) NOT NULL DEFAULT '0' COMMENT '手机号码',
  `car_type` tinyint(1) DEFAULT '0' COMMENT '车型 取自于config中配置id',
  `driver_level` tinyint(1) DEFAULT '0' COMMENT '司机等级 取自于config中配置id',
  `car_id` varchar(16) NOT NULL DEFAULT '' COMMENT '车牌号',
  `good_comment_rate` decimal(4,2) unsigned NOT NULL DEFAULT '0' COMMENT '好评率',
  `driver_completed_orders` int(11) unsigned NOT NULL DEFAULT '0' COMMENT '司机已完成订单',
  `status` tinyint(4) NOT NULL  DEFAULT '1' COMMENT '订单是否使用 0:不正常，1:正常',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '订单生成时间',
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_lxn_order_number` (`lxn_order_number`),
  KEY `idx_uid_status` (`uid`, `status`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT='订单扩展表';


CREATE TABLE `order_address` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT 'id 自增，主键',
  `order_id` bigint(20) unsigned NOT NULL DEFAULT '订单id 对应order表中的id',
  `uid` bigint(20) NOT NULL DEFAULT '' COMMENT '关联user表中uid',
  `contact_phone` char(11) NOT NULL DEFAULT '' COMMENT '联系人手机号',
  `province` varchar(105) NOT NULL DEFAULT '' COMMENT '省份',
  `city` varchar(20) NOT NULL DEFAULT '' COMMENT '城市',
  `county` varchar(100) NOT NULL DEFAULT '' COMMENT '区/县',
  `address` varchar(255) NOT NULL DEFAULT '' COMMENT '详细地址,精确几单元几号楼',
  `remark` varchar(255) NOT NULL DEFAULT '' COMMENT '备注',
  `gps_type` int(11) NOT NULL DEFAULT '1' COMMENT '坐标类型 0 百度， 1高德',
  `lng` varchar(25) DEFAULT '' COMMENT '经度',
  `lat` varchar(25) DEFAULT '',COMMENT '纬度'
  `vlan_id` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '围栏id',
  `stairs_num` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '楼层', 
  `parking_spaces`  tinyint(3) NOT NULL COMMENT DEFAULT '0' '停靠位置 1：单元门口、2：地下车库、3：小区门口 取自于config中配置id'
  `address_type`  tinyint(3) NOT NULL COMMENT DEFAULT '0' '收发地类型 100，途经 101,102 发货 200，收货',
  `status` tinyint(4) NOT NULL  DEFAULT '1' COMMENT '订单是否使用 1：使用，0未使用',
  `is_deleted` tinyint(3) DEFAULT '0' COMMENT '是否删除,1是删除',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '生成时间',
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_order_id` (`lxn_order_id`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT='收发地信息表';


CREATE TABLE `sku_info` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT COMMENT 'id 自增，主键',
  `type` tinyint(1) DEFAULT '0' COMMENT '搬家类型 1:放心搬家 2:日式 3:跨城 4:半日式 取自于config中配置id',
  `car_type` tinyint(1) DEFAULT '0' COMMENT '车型 取自于config中配置id',
  `price` decimal(15,2) NOT NULL DEFAULT '0.00' COMMENT '定金价格',
  `remark` varchar(300) NOT NULL COMMENT '备注',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '生成时间',
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT='sku信息表';

//订单账单表
CREATE TABLE `order_bill` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT 'id 自增，主键',
  `order_id` bigint(20) unsigned NOT NULL DEFAULT '订单id 对应order表中的id',
  `type` tinyint(3) NOT NULL DEFAULT '0' COMMENT 'config中id 付款类型  10:基础费15:超公里费16:超平米数20:等待费30:高速费40:停车费50:夜间服务费60:担保费= 70:搬运费= 75:行程变更费用76:司机修改价格7:司机修改价格－基础价格80:回单费用',
  `amount` decimal(10,2) NOT NULL DEFAULT '0.0' COMMENT '付款金额',
  `status` tinyint(4) NOT NULL DEFAULT '1' COMMENT '是否有效 0无效，1有效',
  `remark` varchar(105) NOT NULL DEFAULT '' COMMENT '备注',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '生成时间',
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_orderid` (`order_id`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 COMMENT='账单明细';

//支付
CREATE TABLE `pay_list` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT 'id 自增，主键',
  `order_id` bigint(20) unsigned NOT NULL DEFAULT '订单id 对应order表中的id',
  `payment_type` tinyint(3) NOT NULL COMMENT DEFAULT '0' '支付方式',
  `payment_amount` float(10,2) NOT NULL COMMENT '支付多少',
  `uid` bigint(20) NOT NULL DEFAULT '' COMMENT '关联user表中uid',
  `serial_num` varchar(64) DEFAULT '' COMMENT '流水号',
  `remark` varchar(105) NOT NULL DEFAULT '' COMMENT '备注',
  `trade_type` int(11) NOT NULL DEFAULT '0' COMMENT '交易类型， 0 订单， 1 发票， 2 司机押金，  5 新搬家订单',
  `appid` varchar(50) NOT NULL DEFAULT '' COMMENT '应用id',
  `is_deleted` tinyint(3) DEFAULT '0' COMMENT '是否删除,1是删除',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `affirm_at` int(11) NOT NULL DEFAULT '0' COMMENT '确认收款时间， 余额， 在线收款为支付时间。  现金为出纳确认收款时间',
  PRIMARY KEY (`id`),
  KEY `orderid_index` (`order_id`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 COMMENT='支付明细';




CREATE TABLE `config` (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '自增id',
  `pid` int(11) NOT NULL DEFAULT '0' COMMENT '父类id',
  `type` varchar(30) NOT NULL DEFAULT '' COMMENT '类型',
  `name` varchar(30) NOT NULL DEFAULT '' COMMENT '名称',
  `value` varchar(64) NOT NULL DEFAULT '' COMMENT '值',
  `note` varchar(255) NOT NULL DEFAULT '' COMMENT '注释',
  `status` tinyint(1) NOT NULL DEFAULT '1' COMMENT '状态: 1正常 0:禁用',
  `sort` smallint(6) NOT NULL DEFAULT '0' COMMENT '排序',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `i_status_type_pid` (`status`,`type`,`pid`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='配置表';


//操作日志
CREATE TABLE `log` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT 'id 自增，主键',
  `type` tinyint(1) NOT NULL DEFAULT '0' COMMENT '业务类型 1:登录 2:订单 ... 取自于config中配置id',
  `operate_id` int(11) NOT NULL DEFAULT '0' COMMENT '操作人id',
  `order_id` int(11) NOT NULL DEFAULT '0' COMMENT '订单号',
  `thing` varchar(1000) NOT NULL DEFAULT '' COMMENT '内部人员具体操作事件',
  `status` tinyint(1) NOT NULL DEFAULT '1' COMMENT '日志信息状态 1为正常 0为废弃',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '生成时间',
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_orderid` (`order_id`),
  KEY `idx_type` (`type`),
  KEY `idx_operate_id` (`operate_id`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 COMMENT='日志表';
